version: "2"

run:
  timeout: 5m
  tests: true

output:
  show-stats: true

issues:
  max-issues-per-linter: 0
  max-same-issues: 0
  exclude-dirs:
    - vendor
    - context
  exclude-rules:
    - path: _test\.go
      linters:
        - gosec
        - errcheck
    # Ignore errcheck for output/reporting files where fmt errors are acceptable
    - path: linter\.go
      linters:
        - errcheck
    - path: reporter.*\.go
      linters:
        - errcheck
    - path: output.*\.go
      linters:
        - errcheck
    - path: scanner\.go
      linters:
        - errcheck
      text: "Error return value of `file\\.Close`"
    # oapi-codegen strict server pattern: returning typed error responses (e.g., 500JSONResponse)
    # with nil error is correct - the response object encodes the HTTP status. Returning non-nil
    # error would bypass our structured response and leak internal error details to clients.
    - path: internal/api/v1/(server|handlers/.*)\.go
      linters:
        - nilerr
    # Server methods implement StrictServerInterface - comments would be redundant boilerplate
    - path: internal/api/v1/server\.go
      linters:
        - revive
    # oapi-codegen generates single-field embedding wrappers (e.g., type XXX500JSONResponse struct{ ErrorResponse })
    # Using unkeyed literals for these is idiomatic and safe - the struct has only one anonymous field.
    - path: internal/api/v1/handlers/.*\.go
      linters:
        - govet
      text: composites

linters:
  disable-all: true
  disable:
    - errcheck
    - gosec
    - gocritic
  enable:
    # --- Default & Critical ---
    - govet
    - staticcheck
    - unused

    # --- Error Handling & Naming ---
    - errname # Enforces "Err" prefix and "Error" suffix
    - errorlint # Enforces Go 1.13+ error wrapping (%w)
    - nilerr # Finds code that returns nil even if checks fail

    # --- Database & Logging ---
    - sqlclosecheck # Prevents connection leaks (vital for SQLite)
    - rowserrcheck # Ensures rows.Err() is checked after iteration
    - sloglint # Ensures structured logging consistency
    - decorder # Ensures correct order

    # --- Quality & Security ---
    - revive # General Go style
    - misspell # Fixes typos
    - nolintlint # Ensures //nolint comments are actually needed
    - testifylint # Ensures correct testify usage
    - noctx # Prevents zombie requests

linters-settings:
  sloglint:
    no-global: "all"
    key-naming-case: snake
    static-msg: true
    no-mixed-args: true

  testifylint:
    enable-all: true

  gocritic:
    disabled-checks:
      - elseif
      - ifElseChain

  gosec:
    excludes:
      - G301  # Expect directory permissions to be 0750 or less
      - G306  # Expect WriteFile permissions to be 0600 or less  
      - G304  # Potential file inclusion via variable
